<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Labs at Yale</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <header class="topbar">
      <div class="inner_topbar">
        <div class="logo">
          <a class="logotext" href="{{ url_for('index') }}"> LabsAtYale </a>
        </div>
        <nav class="navigationBar">
          <a
            href="{{ url_for('fellowships') }}"
            class="{% if request.path == '/fellowships' %}active{% endif %}"
            >Fellowships</a
          >
          <a
            href="{{ url_for('labs') }}"
            class="{% if request.path == '/labs' %}active{% endif %}"
            >Labs</a
          >
          <a
            href="{{ url_for('faculty') }}"
            class="{% if request.path == '/faculty' %}active{% endif %}"
            >Faculty</a
          >

          {% if current_user.role == 'faculty' %}
          <a href="{{ url_for('add_fellowship') }}">Add a Fellowship</a>
          <a
            href="{{ url_for('faculty_fellowships') }}"
            class="{% if request.path == '/faculty/fellowships' %}active{% endif %}"
            >Ranking</a
          >
          <a href="{{ url_for('faculty_all_applicants') }}" class="{% if request.path == '/faculty/applicants' %}active{% endif %}">Applicants</a>
<!--          <a-->
<!--            href="{{ url_for('faculty_fellowship_applicants', fellowship_id=fellowship_id) }}"-->
<!--            class="{% if request.path == '/faculty/fellowship' %}active{% endif %}"-->
<!--            >Applicants</a-->
<!--          >-->
          {% endif %} {% if current_user.role == 'student' %}
          <a
            href="{{ url_for('applications') }}"
            class="{% if request.path == '/applications' %}active{% endif %}"
            >Applications</a
          >
          <a
            href="{{ url_for('saved_fellowships') }}"
            class="{% if request.path == '/saved_fellowships' %}active{% endif %}"
            >Saved Fellowships</a
          >
          {% endif %} {% if current_user.is_authenticated %}
          <a
            href="{{ url_for('profile') }}"
            class="{% if request.path == '/profile' %}active{% endif %}"
            >Profile</a
          >
          <a href="{{ url_for('logout') }}">Logout</a>
          {% else %}
          <a href="{{ url_for('login') }}">Login</a>
          {% endif %}
        </nav>
      </div>
    </header>

    <form class="searchbar" action="{{ url_for('labs') }}" method="get">
      <input
        type="search"
        id="search-input"
        name="q"
        placeholder="Search for a Lab"
        value="{{ q }}"
      />
      <button type="submit" class="btn btn--primary">Search</button>
    </form>

    {% if labs_list|length == 0 %} (None) {% else %}
    <table class="result-table">
      <thead>
        <tr>
          <th>Lab Name</th>
          <th>Faculty Name</th>
          <th>Faculty Email</th>
          <th>Field</th>
          <th>Description</th>
          <th>Website</th>
          <th>Location</th>
        </tr>
      </thead>
      <tbody>
        {% for lab in labs_list %}
        <tr
          class="lab-row"
          data-lab-name="{{ lab.get_lab_name() }}"
          data-faculty="{{ lab.get_faculty_name() }}"
          data-email="{{ lab.get_email() }}"
          data-field="{{ lab.get_field() }}"
          data-description="{{ lab.get_description() }}"
          data-website="{{ lab.get_website() }}"
          data-location="{{ lab.get_location() }}"
        >
          <td>{{ lab.get_lab_name() }}</td>
          <td>{{ lab.get_faculty_name() }}</td>
          <td>{{ lab.get_email() }}</td>
          <td>{{ lab.get_field() }}</td>
          <td>{{ lab.get_description() }}</td>
          <td>{{ lab.get_website() |safe }}</td>
          <td>{{ lab.get_location() }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}
    <div id="modal" class="modal-overlay">
      <div class="modal-card">
        <button type="button" class="modal-close">&times;</button>

        <h1 id="modal-lab-name"></h1>

        <p id="modal-description"></p>

        <p>
          <strong>PI:</strong> <span id="modal-faculty"></span><br />
          <strong>Email:</strong> <span id="modal-email"></span><br />
          <strong>Field:</strong> <span id="modal-field"></span><br />
          <strong>Location:</strong> <span id="modal-location"></span>
        </p>

        <p>
          <strong>Website:</strong>
          <span id="modal-website"></span>
        </p>
      </div>
    </div>
    <script>
      (function () {
        // doocument = entire HTML page --> for adding more detail about the lab here
        const modal = document.getElementById("modal");
        const closeBtn = modal.querySelector(".modal-close");
        const nameEl = document.getElementById("modal-lab-name");
        const descEl = document.getElementById("modal-description");
        const facultyEl = document.getElementById("modal-faculty");
        const emailEl = document.getElementById("modal-email");
        const fieldEl = document.getElementById("modal-field");
        const locationEl = document.getElementById("modal-location");
        const websiteEl = document.getElementById("modal-website");
        function openModalFromRow(row) {
          nameEl.textContent = row.dataset.labName;
          descEl.textContent = row.dataset.description;
          facultyEl.textContent = row.dataset.faculty;
          emailEl.textContent = row.dataset.email;
          fieldEl.textContent = row.dataset.field;
          locationEl.textContent = row.dataset.location;
          websiteEl.innerHTML = row.dataset.website;
          modal.classList.add("open");
          document.body.classList.add("modal-open");
        }
        function closeModal() {
          modal.classList.remove("open");
          document.body.classList.remove("modal-open");
        }
        document.querySelectorAll(".lab-row").forEach(function (row) {
          row.addEventListener("click", function () {
            openModalFromRow(row);
          });
        });

        closeBtn.addEventListener("click", closeModal);

        modal.addEventListener("click", function (e) {
          if (e.target === modal) {
            closeModal();
          }
        });
      })();
    </script>
  </body>
</html>
