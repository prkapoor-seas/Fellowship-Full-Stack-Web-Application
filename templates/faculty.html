<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Labs at Yale</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <header class="topbar">
      <div class="inner_topbar">
        <div class="logo">
          <a class="logotext" href="{{ url_for('index') }}"> LabsAtYale </a>
        </div>
        <nav class="navigationBar">
          <a
            href="{{ url_for('fellowships') }}"
            class="{% if request.path == '/fellowships' %}active{% endif %}"
            >Fellowships</a
          >
          <a
            href="{{ url_for('labs') }}"
            class="{% if request.path == '/labs' %}active{% endif %}"
            >Labs</a
          >
          <a
            href="{{ url_for('faculty') }}"
            class="{% if request.path == '/faculty' %}active{% endif %}"
            >Faculty</a
          >

          {% if current_user.role == 'faculty' %}
            <a href="{{ url_for('add_fellowship') }}">Add a Fellowship</a>
            <a href="{{ url_for('faculty_fellowships') }}" class="{% if request.path == '/faculty/fellowships' %}active{% endif %}">Ranking</a>
            <a href="{{ url_for('faculty_all_applicants') }}" class="{% if request.path == '/faculty/applicants' %}active{% endif %}">Applicants</a>
<!--            {% if fellowship_id %}<a href="{{ url_for('faculty_fellowship_applicants', fellowship_id=fellowship_id) }}" class="{% if request.path == '/faculty/fellowship' %}active{% endif %}">Applicants</a>{% endif %}-->
          {% endif %}

            {% if current_user.role == 'student' %}
            <a href="{{ url_for('applications') }}" class="{% if request.path == '/applications' %}active{% endif %}">Applications</a>
            <a href="{{ url_for('saved_fellowships') }}" class="{% if request.path == '/saved_fellowships' %}active{% endif %}">Saved Fellowships</a>
          {% endif %}

          {% if current_user.is_authenticated %}
              <a
                href="{{ url_for('profile') }}"
                class="{% if request.path == '/profile' %}active{% endif %}"
                >Profile</a
              >
              <a href="{{ url_for('logout') }}">Logout</a>
            {% else %}
              <a href="{{ url_for('login') }}">Login</a>
          {% endif %}
        </nav>
      </div>
    </header>

    <form class="searchbar" action="{{ url_for('faculty') }}" method="get">
      <input
        type="search"
        id="search-input"
        name="q"
        placeholder="Search for Faculty"
        value="{{ q }}"
      />
      <button type="submit" class="btn btn--primary">Search</button>
    </form>

    {% if faculty_list|length == 0 %} (None) {% else %}
    <table class="result-table">
      <thead>
        <tr>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th>
          <th>Department</th>
        </tr>
      </thead>
      <tbody>
        {% for f in faculty_list %}
          <tr
            class="faculty-row"
            data-first-name="{{ f.get_first_name() }}"
            data-last-name="{{ f.get_last_name() }}"
            data-email="{{ f.get_email() }}"
            data-dept="{{ f.get_department() }}"
          >
          <td>{{f.get_first_name()}}</td>
          <td>{{f.get_last_name()}}</td>
          <td>{{f.get_email()}}</td>
          <td>{{ f.get_department() }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}

  <div id="modal" class="modal-overlay">
      <div class="modal-card">
        <button type="button" class="modal-close">&times;</button>

        <h1 id="modal-faculty-name"></h1>

        <p>
          <strong>Email:</strong> <span id="modal-email"></span><br />
          <strong>Department:</strong> <span id="modal-dept"></span><br />

        </p>

      </div>
    </div>
    <script>
      (function () {

        const modal = document.getElementById("modal");
        const closeBtn = modal.querySelector(".modal-close");

        const nameEl = document.getElementById("modal-faculty-name");
        const emailEl = document.getElementById("modal-email");
        const departEl = document.getElementById("modal-dept");

        function openModalFromRow(row) {
          nameEl.textContent = row.dataset.firstName + " " + row.dataset.lastName;
          emailEl.textContent = row.dataset.email;
          departEl.textContent = row.dataset.dept;

          modal.classList.add("open");
          document.body.classList.add("modal-open");
        }

        function closeModal() {
          modal.classList.remove("open");
          document.body.classList.remove("modal-open");
        }

        document.querySelectorAll(".faculty-row").forEach(function (row) {
          row.addEventListener("click", function () {
            openModalFromRow(row);
          });
        });

        closeBtn.addEventListener("click", closeModal);

        modal.addEventListener("click", function (e) {
          if (e.target === modal) closeModal();
        });

      })();
      </script>
  </body>
</html>
